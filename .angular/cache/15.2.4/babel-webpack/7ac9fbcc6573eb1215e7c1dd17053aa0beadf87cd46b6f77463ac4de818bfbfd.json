{"ast":null,"code":"import _defineProperty from \"C:/Users/OSCAR/Angular/store/store/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { delay, switchMap, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared/services/data.service\";\nimport * as i2 from \"./../../shared/services/shopping-cart.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../products/services/products.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"./details/details.component\";\nfunction CheckoutComponent_mat_error_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Name is required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CheckoutComponent_ng_container_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-form-field\", 3)(2, \"input\", 13, 14);\n    i0.ɵɵlistener(\"ngModelChange\", function CheckoutComponent_ng_container_14_Template_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.model.shippingAddress = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"mat-form-field\", 3)(5, \"input\", 15, 16);\n    i0.ɵɵlistener(\"ngModelChange\", function CheckoutComponent_ng_container_14_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.model.city = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.model.shippingAddress);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.model.city);\n  }\n}\nfunction CheckoutComponent_ng_template_15_mat_option_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const tienda_r13 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", tienda_r13);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", tienda_r13.name, \" - \", tienda_r13.openingHours, \" \");\n  }\n}\nfunction CheckoutComponent_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-form-field\", 3)(1, \"mat-label\");\n    i0.ɵɵtext(2, \"Select me\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mat-select\", 17, 18);\n    i0.ɵɵlistener(\"ngModelChange\", function CheckoutComponent_ng_template_15_Template_mat_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.model.store = $event);\n    });\n    i0.ɵɵtemplate(5, CheckoutComponent_ng_template_15_mat_option_5_Template, 2, 3, \"mat-option\", 19);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r5.model.store);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.stores);\n  }\n}\nexport class CheckoutComponent {\n  constructor(dataSvc, shoppingCartSvc, router, productsSvc) {\n    _defineProperty(this, \"dataSvc\", void 0);\n    _defineProperty(this, \"shoppingCartSvc\", void 0);\n    _defineProperty(this, \"router\", void 0);\n    _defineProperty(this, \"productsSvc\", void 0);\n    _defineProperty(this, \"model\", {\n      name: 'Dominicode',\n      store: '',\n      shippingAddress: '',\n      city: ''\n    });\n    _defineProperty(this, \"isDelivery\", true);\n    _defineProperty(this, \"cart\", []);\n    _defineProperty(this, \"stores\", []);\n    this.dataSvc = dataSvc;\n    this.shoppingCartSvc = shoppingCartSvc;\n    this.router = router;\n    this.productsSvc = productsSvc;\n    this.checkIfCartIsEmpty();\n  }\n  ngOnInit() {\n    this.getStores();\n    this.getDataCart();\n    this.prepareDetails();\n  }\n  onPickupOrDelivery(value) {\n    this.isDelivery = value;\n  }\n  onSubmit({\n    value: formData\n  }) {\n    console.log('Guardar', formData);\n    const data = {\n      ...formData,\n      date: this.getCurrentDay(),\n      isDelivery: this.isDelivery\n    };\n    this.dataSvc.saveOrder(data).pipe(tap(res => console.log('Order ->', res)), switchMap(({\n      id: orderId\n    }) => {\n      const details = this.prepareDetails();\n      return this.dataSvc.saveDetailsOrder({\n        details,\n        orderId\n      });\n    }), tap(() => this.router.navigate(['/checkout/thank-you-page'])), delay(2000), tap(() => this.shoppingCartSvc.resetCart())).subscribe();\n  }\n  getStores() {\n    this.dataSvc.getStores().pipe(tap(stores => this.stores = stores)).subscribe();\n  }\n  getCurrentDay() {\n    return new Date().toLocaleDateString();\n  }\n  prepareDetails() {\n    const details = [];\n    this.cart.forEach(product => {\n      const {\n        id: productId,\n        name: productName,\n        qty: quantity,\n        stock\n      } = product;\n      const updateStock = stock - quantity;\n      this.productsSvc.updateStock(productId, updateStock).pipe(tap(() => details.push({\n        productId,\n        productName,\n        quantity\n      }))).subscribe();\n    });\n    return details;\n  }\n  getDataCart() {\n    this.shoppingCartSvc.cartAction$.pipe(tap(products => this.cart = products)).subscribe();\n  }\n  checkIfCartIsEmpty() {\n    this.shoppingCartSvc.cartAction$.pipe(tap(products => {\n      if (Array.isArray(products) && !products.length) {\n        this.router.navigate(['/products']);\n      }\n    })).subscribe();\n  }\n}\n_defineProperty(CheckoutComponent, \"\\u0275fac\", function CheckoutComponent_Factory(t) {\n  return new (t || CheckoutComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.ShoppingCartService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.ProductsService));\n});\n_defineProperty(CheckoutComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CheckoutComponent,\n  selectors: [[\"app-checkout\"]],\n  decls: 21,\n  vars: 5,\n  consts: [[1, \"container\"], [1, \"form\"], [\"checkoutForm\", \"ngForm\"], [1, \"form__element\"], [\"matInput\", \"\", \"placeholder\", \"Name\", \"required\", \"\", \"name\", \"name\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"ngModel\"], [4, \"ngIf\"], [\"value\", \"pickup\", 3, \"change\"], [\"value\", \"delivery\", \"checked\", \"\", 3, \"change\"], [4, \"ngIf\", \"ngIfElse\"], [\"showStores\", \"\"], [1, \"actions\"], [\"color\", \"primary\", \"mat-raised-button\", \"\", \"type\", \"submit\", 1, \"actions__btn\", 3, \"disabled\", \"click\"], [\"matInput\", \"\", \"placeholder\", \"Shipping Address\", \"name\", \"shippingAddress\", 3, \"ngModel\", \"ngModelChange\"], [\"shippingAddress\", \"ngModel\"], [\"matInput\", \"\", \"placeholder\", \"City\", \"name\", \"city\", 3, \"ngModel\", \"ngModelChange\"], [\"city\", \"ngModel\"], [\"name\", \"store\", 3, \"ngModel\", \"ngModelChange\"], [\"store\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"]],\n  template: function CheckoutComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      const _r16 = i0.ɵɵgetCurrentView();\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1, 2)(3, \"mat-form-field\", 3)(4, \"input\", 4, 5);\n      i0.ɵɵlistener(\"ngModelChange\", function CheckoutComponent_Template_input_ngModelChange_4_listener($event) {\n        return ctx.model.name = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(6, CheckoutComponent_mat_error_6_Template, 2, 0, \"mat-error\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"mat-radio-group\", 3)(8, \"p\");\n      i0.ɵɵtext(9, \"Choose an option:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"mat-radio-button\", 7);\n      i0.ɵɵlistener(\"change\", function CheckoutComponent_Template_mat_radio_button_change_10_listener() {\n        return ctx.onPickupOrDelivery(false);\n      });\n      i0.ɵɵtext(11, \"Pickup\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"mat-radio-button\", 8);\n      i0.ɵɵlistener(\"change\", function CheckoutComponent_Template_mat_radio_button_change_12_listener() {\n        return ctx.onPickupOrDelivery(true);\n      });\n      i0.ɵɵtext(13, \" Delivery \");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(14, CheckoutComponent_ng_container_14_Template, 7, 2, \"ng-container\", 9);\n      i0.ɵɵtemplate(15, CheckoutComponent_ng_template_15_Template, 6, 2, \"ng-template\", null, 10, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelement(17, \"app-details\");\n      i0.ɵɵelementStart(18, \"div\", 11)(19, \"button\", 12);\n      i0.ɵɵlistener(\"click\", function CheckoutComponent_Template_button_click_19_listener() {\n        i0.ɵɵrestoreView(_r16);\n        const _r0 = i0.ɵɵreference(2);\n        return i0.ɵɵresetView(ctx.onSubmit(_r0));\n      });\n      i0.ɵɵtext(20, \" Checkout \");\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(2);\n      const _r1 = i0.ɵɵreference(5);\n      const _r4 = i0.ɵɵreference(16);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.model.name);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", !_r1.valid || _r1.pristine);\n      i0.ɵɵadvance(8);\n      i0.ɵɵproperty(\"ngIf\", ctx.isDelivery)(\"ngIfElse\", _r4);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"disabled\", !_r0.form.valid);\n    }\n  },\n  dependencies: [i5.NgForOf, i5.NgIf, i6.ɵNgNoValidate, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgControlStatusGroup, i6.RequiredValidator, i6.NgModel, i6.NgForm, i7.DetailsComponent],\n  styles: [\".container[_ngcontent-%COMP%] {\\n  margin: 6rem auto 0;\\n  width: 90%;\\n}\\n\\n.form__element[_ngcontent-%COMP%] {\\n  margin-bottom: 0.5rem;\\n  width: 100%;\\n}\\n.form[_ngcontent-%COMP%]   .mat-radio-group[_ngcontent-%COMP%] {\\n  display: block;\\n}\\n.form[_ngcontent-%COMP%]   .mat-radio-button[_ngcontent-%COMP%] {\\n  margin-right: 1rem;\\n}\\n\\n.actions[_ngcontent-%COMP%] {\\n  margin: 4rem auto 0;\\n  width: 40%;\\n}\\n.actions__btn[_ngcontent-%COMP%] {\\n  width: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvY2hlY2tvdXQvY2hlY2tvdXQuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxtQkFBQTtFQUNBLFVBQUE7QUFDRjs7QUFHRTtFQUNFLHFCQUFBO0VBQ0EsV0FBQTtBQUFKO0FBR0U7RUFDRSxjQUFBO0FBREo7QUFJRTtFQUNFLGtCQUFBO0FBRko7O0FBTUE7RUFDRSxtQkFBQTtFQUNBLFVBQUE7QUFIRjtBQUtFO0VBQ0UsV0FBQTtBQUhKIiwic291cmNlc0NvbnRlbnQiOlsiLmNvbnRhaW5lciB7XG4gIG1hcmdpbjogNnJlbSBhdXRvIDA7XG4gIHdpZHRoOiA5MCU7XG59XG5cbi5mb3JtIHtcbiAgJl9fZWxlbWVudCB7XG4gICAgbWFyZ2luLWJvdHRvbTogLjVyZW07XG4gICAgd2lkdGg6IDEwMCU7XG4gIH1cblxuICAubWF0LXJhZGlvLWdyb3VwIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgfVxuXG4gIC5tYXQtcmFkaW8tYnV0dG9uIHtcbiAgICBtYXJnaW4tcmlnaHQ6IDFyZW07XG4gIH1cbn1cblxuLmFjdGlvbnMge1xuICBtYXJnaW46IDRyZW0gYXV0byAwO1xuICB3aWR0aDogNDAlO1xuXG4gICZfX2J0biB7XG4gICAgd2lkdGg6IDEwMCU7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n}));","map":{"version":3,"mappings":"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","names":["delay","switchMap","tap","i0","CheckoutComponent","constructor","dataSvc","shoppingCartSvc","router","productsSvc","name","store","shippingAddress","city","checkIfCartIsEmpty","ngOnInit","getStores","getDataCart","prepareDetails","onPickupOrDelivery","value","isDelivery","onSubmit","formData","console","log","data","date","getCurrentDay","saveOrder","pipe","res","id","orderId","details","saveDetailsOrder","navigate","resetCart","subscribe","stores","Date","toLocaleDateString","cart","forEach","product","productId","productName","qty","quantity","stock","updateStock","push","cartAction$","products","Array","isArray","length","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\OSCAR\\Angular\\store\\store\\src\\app\\pages\\checkout\\checkout.component.ts","C:\\Users\\OSCAR\\Angular\\store\\store\\src\\app\\pages\\checkout\\checkout.component.html"],"sourcesContent":["import { ShoppingCartService } from './../../shared/services/shopping-cart.service';\nimport { NgForm } from '@angular/forms';\nimport { Component, OnInit } from '@angular/core';\nimport { delay, switchMap, tap } from 'rxjs/operators';\nimport { Store } from 'src/app/shared/interfaces/stores.interface';\nimport { DataService } from 'src/app/shared/services/data.service';\nimport { Details, Order } from 'src/app/shared/interfaces/order.interface';\nimport { Product } from '../products/interfaces/product.interface';\nimport { Router } from '@angular/router';\nimport { ProductsService } from '../products/services/products.service';\n\n@Component({\n  selector: 'app-checkout',\n  templateUrl: './checkout.component.html',\n  styleUrls: ['./checkout.component.scss']\n})\nexport class CheckoutComponent implements OnInit {\n  model = {\n    name: 'Dominicode',\n    store: '',\n    shippingAddress: '',\n    city: ''\n  };\n  isDelivery = true;\n  cart: Product[] = [];\n  stores: Store[] = []\n  constructor(\n    private dataSvc: DataService,\n    private shoppingCartSvc: ShoppingCartService,\n    private router: Router,\n    private productsSvc: ProductsService\n  ) {\n    this.checkIfCartIsEmpty();\n  }\n\n  ngOnInit(): void {\n    this.getStores();\n    this.getDataCart();\n    this.prepareDetails();\n  }\n\n  onPickupOrDelivery(value: boolean): void {\n    this.isDelivery = value;\n  }\n\n  onSubmit({ value: formData }: NgForm): void {\n    console.log('Guardar', formData);\n    const data: Order = {\n      ...formData,\n      date: this.getCurrentDay(),\n      isDelivery: this.isDelivery\n    }\n    this.dataSvc.saveOrder(data)\n      .pipe(\n        tap(res => console.log('Order ->', res)),\n        switchMap(({ id: orderId }) => {\n          const details = this.prepareDetails();\n          return this.dataSvc.saveDetailsOrder({ details, orderId });\n        }),\n        tap(() => this.router.navigate(['/checkout/thank-you-page'])),\n        delay(2000),\n        tap(() => this.shoppingCartSvc.resetCart())\n      )\n      .subscribe();\n  }\n\n  private getStores(): void {\n    this.dataSvc.getStores()\n      .pipe(\n        tap((stores: Store[]) => this.stores = stores))\n      .subscribe()\n  }\n\n  private getCurrentDay(): string {\n    return new Date().toLocaleDateString();\n  }\n\n  private prepareDetails(): Details[] {\n    const details: Details[] = [];\n    this.cart.forEach((product: Product) => {\n      const { id: productId, name: productName, qty: quantity, stock } = product;\n      const updateStock = (stock - quantity);\n\n      this.productsSvc.updateStock(productId, updateStock)\n        .pipe(\n          tap(() => details.push({ productId, productName, quantity }))\n        )\n        .subscribe()\n\n\n    })\n    return details;\n  }\n\n  private getDataCart(): void {\n    this.shoppingCartSvc.cartAction$\n      .pipe(\n        tap((products: Product[]) => this.cart = products)\n      )\n      .subscribe()\n\n\n\n  }\n\n  private checkIfCartIsEmpty(): void {\n    this.shoppingCartSvc.cartAction$\n      .pipe(\n        tap((products: Product[]) => {\n          if (Array.isArray(products) && !products.length) {\n            this.router.navigate(['/products']);\n          }\n        })\n      )\n      .subscribe()\n  }\n}\n\n","<div class=\"container\">\n  <form class=\"form\" #checkoutForm=\"ngForm\">\n    <mat-form-field class=\"form__element\">\n      <input\n        matInput\n        placeholder=\"Name\"\n        required\n        [(ngModel)]=\"model.name\"\n        name=\"name\"\n        #name=\"ngModel\"\n      />\n      <mat-error *ngIf=\"!name.valid || name.pristine\">\n        Name is required\n      </mat-error>\n    </mat-form-field>\n    <mat-radio-group class=\"form__element\">\n      <p>Choose an option:</p>\n      <mat-radio-button value=\"pickup\" (change)=\"onPickupOrDelivery(false)\"\n        >Pickup</mat-radio-button\n      >\n      <mat-radio-button\n        value=\"delivery\"\n        (change)=\"onPickupOrDelivery(true)\"\n        checked\n      >\n        Delivery\n      </mat-radio-button>\n    </mat-radio-group>\n    <ng-container *ngIf=\"isDelivery; else showStores\">\n      <mat-form-field class=\"form__element\">\n        <input\n          matInput\n          placeholder=\"Shipping Address\"\n          [(ngModel)]=\"model.shippingAddress\"\n          name=\"shippingAddress\"\n          #shippingAddress=\"ngModel\"\n        />\n      </mat-form-field>\n      <mat-form-field class=\"form__element\">\n        <input\n          matInput\n          placeholder=\"City\"\n          [(ngModel)]=\"model.city\"\n          name=\"city\"\n          #city=\"ngModel\"\n        />\n      </mat-form-field>\n    </ng-container>\n    <ng-template #showStores>\n      <mat-form-field class=\"form__element\">\n        <mat-label>Select me</mat-label>\n        <mat-select name=\"store\" #store=\"ngModel\" [(ngModel)]=\"model.store\">\n          <mat-option [value]=\"tienda\" *ngFor=\"let tienda of stores\">\n            {{ tienda.name }} - {{ tienda.openingHours }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </ng-template>\n  </form>\n</div>\n<app-details></app-details>\n<div class=\"actions\">\n  <button\n    (click)=\"onSubmit(checkoutForm)\"\n    [disabled]=\"!checkoutForm.form.valid\"\n    class=\"actions__btn\"\n    color=\"primary\"\n    mat-raised-button\n    type=\"submit\"\n  >\n    Checkout\n  </button>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}